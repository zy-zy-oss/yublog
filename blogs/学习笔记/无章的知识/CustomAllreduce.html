<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Yu's blog ğŸ¥º</title>
    <meta name="description" content="A VitePress Site">
    <meta name="generator" content="VitePress v1.5.0">
    <link rel="preload stylesheet" href="/yublog/assets/style.DL6Wx8mf.css" as="style">
    <link rel="preload stylesheet" href="/yublog/vp-icons.css" as="style">
    
    <script type="module" src="/yublog/assets/app.BZMRDnZW.js"></script>
    <link rel="preload" href="/yublog/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/yublog/assets/chunks/theme.XdlP_sY-.js">
    <link rel="modulepreload" href="/yublog/assets/chunks/framework.D2ql23Gy.js">
    <link rel="modulepreload" href="/yublog/assets/blogs_å­¦ä¹ ç¬”è®°_æ— ç« çš„çŸ¥è¯†_CustomAllreduce.md.C298wKmd.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-6aa21345><div class="wrapper" data-v-6aa21345><div class="container" data-v-6aa21345><div class="title" data-v-6aa21345><div class="VPNavBarTitle has-sidebar" data-v-6aa21345 data-v-1168a8e4><a class="title" href="/yublog/" data-v-1168a8e4><!--[--><!--]--><!----><span data-v-1168a8e4>Yu&#39;s blog ğŸ¥º</span><!--[--><!--]--></a></div></div><div class="content" data-v-6aa21345><div class="content-body" data-v-6aa21345><!--[--><!--]--><div class="VPNavBarSearch search" data-v-6aa21345><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-6aa21345 data-v-dc692963><span id="main-nav-aria-label" class="visually-hidden" data-v-dc692963> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/yublog/pages/about.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>ğŸŒ² About</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/yublog/blogs/hello.html" tabindex="0" data-v-dc692963 data-v-e56f3d57><!--[--><span data-v-e56f3d57>â›„ï¸ Blogs</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-6aa21345 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-6aa21345 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-6aa21345 data-v-bb2aa2f0 data-v-cf11d7a2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-cf11d7a2><span class="vpi-more-horizontal icon" data-v-cf11d7a2></span></button><div class="menu" data-v-cf11d7a2><div class="VPMenu" data-v-cf11d7a2 data-v-b98bc113><!----><!--[--><!--[--><!----><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>Appearance</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/vuejs/vitepress" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-bd121fe5><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-6aa21345 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-6aa21345><div class="divider-line" data-v-6aa21345></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-17a5e62e><button data-v-17a5e62e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-319d5ca6><div class="curtain" data-v-319d5ca6></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-319d5ca6><span class="visually-hidden" id="sidebar-aria-label" data-v-319d5ca6> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-c40bc020><section class="VPSidebarItem level-0 has-active" data-v-c40bc020 data-v-b7550ba0><!----><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/hello.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>hello</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-1 collapsible collapsed has-active" data-v-b7550ba0 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h3 class="text" data-v-b7550ba0>å­¦ä¹ ç¬”è®°</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/index.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>index</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/tailwind.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>tailwind</p><!--]--></a><!----></div><!----></div><section class="VPSidebarItem level-2 collapsible collapsed has-active" data-v-b7550ba0 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h4 class="text" data-v-b7550ba0>æ— ç« çš„çŸ¥è¯†</h4><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-3 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/CustomAllreduce.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>CustomAllreduce</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/jsxè¯¦è§£.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>jsxè¯¦è§£</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/react--useContextç§’æ‡‚è¯¦è§£.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>react--useContextç§’æ‡‚è¯¦è§£</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/react--useEffectä½•æ—¶è°ƒç”¨.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>react--useEffectä½•æ—¶è°ƒç”¨</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/react--useEffectæ¡ˆä¾‹è¯¦è§£.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>react--useEffectæ¡ˆä¾‹è¯¦è§£</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/react--useReducer.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>react--useReducer</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/react--useRefè¯¦è§£.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>react--useRefè¯¦è§£</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/reactç”Ÿå‘½å‘¨æœŸè¯¦è§£.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>reactç”Ÿå‘½å‘¨æœŸè¯¦è§£</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/ä¸ºä»€ä¹ˆitemçš„keyä¸èƒ½ç”¨index.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>ä¸ºä»€ä¹ˆitemçš„keyä¸èƒ½ç”¨index</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/å—æ§ç»„ä»¶input.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>å—æ§ç»„ä»¶input</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/å¦‚ä½•ç†è§£llmappæµå¼è¾“å‡º.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>å¦‚ä½•ç†è§£llmappæµå¼è¾“å‡º</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/æ¸²æŸ“æ˜¯ä»€ä¹ˆï¼Ÿ.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>æ¸²æŸ“æ˜¯ä»€ä¹ˆï¼Ÿ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-3 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/é‡è§linkå’Œé‡è§scriptçš„åŒºåˆ«.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>é‡è§linkå’Œé‡è§scriptçš„åŒºåˆ«</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-2 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/ğŸ“–CSSæ‹¨å¼€äº‘é›¾è§æ›™å…‰.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>ğŸ“–CSSæ‹¨å¼€äº‘é›¾è§æ›™å…‰</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/ğŸ“–ä»0åˆ°1çš„reacté€Ÿæˆ.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>ğŸ“–ä»0åˆ°1çš„reacté€Ÿæˆ</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-b7550ba0 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h3 class="text" data-v-b7550ba0>æ‚è®°</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/æ‚è®°/index.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>index</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 collapsible collapsed" data-v-b7550ba0 data-v-b7550ba0><div class="item" role="button" tabindex="0" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><h3 class="text" data-v-b7550ba0>é¢ç»</h3><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b7550ba0><span class="vpi-chevron-right caret-icon" data-v-b7550ba0></span></div></div><div class="items" data-v-b7550ba0><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b7550ba0 data-v-b7550ba0><div class="item" data-v-b7550ba0><div class="indicator" data-v-b7550ba0></div><a class="VPLink link link" href="/yublog/blogs/é¢ç»/index.html" data-v-b7550ba0><!--[--><p class="text" data-v-b7550ba0>index</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>On this page</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _yublog_blogs_%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0_%E6%97%A0%E7%AB%A0%E7%9A%84%E7%9F%A5%E8%AF%86_CustomAllreduce" data-v-39a288b8><div><p>å…³é”®ç»†èŠ‚å¯ä»¥ç›´æ¥è·³è½¬åˆ°ï¼š<a href="#ReduceScatter">Reduce Scatter</a></p><h2 id="ç¬¦å·è§£é‡Š" tabindex="-1">ç¬¦å·è§£é‡Š <a class="header-anchor" href="#ç¬¦å·è§£é‡Š" aria-label="Permalink to &quot;ç¬¦å·è§£é‡Š&quot;">â€‹</a></h2><table tabindex="0"><thead><tr><th>name</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>world_sizeï¼ˆngpusï¼‰</td><td>nodeä¸­çš„GPUæ•°é‡</td></tr><tr><td>rank_data</td><td>ä¸€ä¸ªåˆ†é…åœ¨GPUä¸Šçš„æŒ‡é’ˆæ± ï¼Œå…¶ä¸­C++ä¸­å¯¹RankDataçš„å®šä¹‰æ˜¯ <code>struct{void * ptrs[8]}</code>è¿™é‡Œå–8æ˜¯å› ä¸ºCustomAllreduceæ“ä½œæ”¯æŒçš„æœ€å¤§GPUæ•°é‡æ˜¯8ï¼Œè¿™å‡ ä¸ªæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘åŒä¸€nodeä¸Šçš„å¤šä¸ªGPUä¸Šçš„å³å°†ç”¨äºallreduceæ“ä½œçš„è¾“å…¥å˜é‡</td></tr><tr><td>&quot;register&quot;</td><td>ä¸‹é¢å‡½æ•°çš„æ ‡è¯†ç¬¦ä¸­æœ‰registerå­˜åœ¨ï¼Œregisteråº”è¯¥è¡¨ç¤ºçš„æ˜¯ï¼š å°†å†…å­˜ä¸­çš„RankDataæ‹·è´åˆ°GPUæ˜¾å­˜çš„rank_dataæ± ä¸­</td></tr><tr><td>handleå’Œptr</td><td>handleæ˜¯é€šè¿‡CUDAè¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰å‡½æ•°è·å–çš„è¿”å›å€¼ï¼Œå¯ä»¥ä¼ é€’ç»™å…¶ä»–è¿›ç¨‹å¹¶åœ¨å…¶ä»–è¿›ç¨‹é€šè¿‡OpenIpcHandleæ‰“å¼€ä»¥è·å–ptr</td></tr></tbody></table><h2 id="api-overview" tabindex="-1">API overview <a class="header-anchor" href="#api-overview" aria-label="Permalink to &quot;API overview&quot;">â€‹</a></h2><ul><li><a href="#create_shared_buffer">create_shared_buffer</a>/free_shared_buffer ï¼š åˆ›å»ºã€é‡Šæ”¾å…±äº«å†…å­˜ï¼ˆGPUä¸Šçš„å†…å­˜ï¼‰</li><li><a href="#capture">capture</a>: @contextmanager The main responsibility of this context manager is the <code>register_graph_buffers</code> call at the end of the context.</li><li><a href="#register_graph_buffers">register_graph_buffers</a></li><li>should_custom_ar ï¼šåˆ¤æ–­æ˜¯å¦åº”è¯¥ä½¿ç”¨custom_all_reduce</li><li><a href="#all_reduce">all_reduce</a> :custom_all_reduceè°ƒç”¨çš„å‡½æ•°ï¼Œè°ƒç”¨äº†cudaå®šä¹‰çš„å‡½æ•°</li><li>custom_all_reduce å¯¹å¤–è°ƒç”¨çš„æ¥å£</li><li><a href="#is_weak_contiguous">is_weak_contiguous</a>(Tensor): åˆ¤æ–­Tensoræ˜¯å¦â€œå¼±è¿ç»­â€</li></ul><h2 id="details" tabindex="-1">Details <a class="header-anchor" href="#details" aria-label="Permalink to &quot;Details&quot;">â€‹</a></h2><h3 id="is-weak-contiguous" tabindex="-1"><strong>is_weak_contiguous</strong> <a class="header-anchor" href="#is-weak-contiguous" aria-label="Permalink to &quot;**is_weak_contiguous**&quot;">â€‹</a></h3><p>ä¾‹å¦‚ä¸‹é¢çš„ç¨‹åºè¾“å‡ºä¸ºFalseï¼Œä½†æ˜¯is_weak_contiguousè¾“å‡ºä¸ºTrueï¼Œ</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>import torch</span></span>
<span class="line"><span></span></span>
<span class="line"><span>x = randn(2, 2)</span></span>
<span class="line"><span>y = x.transpose(0, 1)</span></span>
<span class="line"><span>print(y.is_contiguous())  # False</span></span>
<span class="line"><span>print(is_weak_contiguous(y))  #True</span></span></code></pre></div><p>è¿™ä¸ªå‡½æ•°ä¼šåœ¨is_contiguous()è¿”å›å€¼ä¸ºFalseæ—¶ç»§ç»­åˆ¤æ–­ï¼Œå¦‚æœè¾“å…¥çš„Tensoråœ¨åˆ†é…çš„å†…å­˜ä¸­å¤„äºæœ€åä¸€æ®µè€Œä¸”åœ¨å†…å­˜ä¸­è¿ç»­ï¼Œåˆ™è¿”å›True</p><p>æ­¤å‡½æ•°çš„ä½œç”¨ï¼š è¿›è¡Œè¿›ç¨‹é—´é€šä¿¡æ—¶éœ€è¦ä½¿ç”¨$getMemHandle$ï¼Œè·å–åˆ°çš„Handleæ˜¯æŒ‡å‘é¢„åˆ†é…å†…å­˜èµ·å§‹åœ°å€çš„Handleï¼Œéœ€è¦æœ‰ä¸€ä¸ªoffsetè¡¨ç¤ºè¾“å…¥Tensorç›¸å¯¹è¿™ä¸ªèµ·å§‹åœ°å€çš„åç§»é‡</p><h4 id="create-shared-buffer" tabindex="-1"><strong>create_shared_buffer</strong> <a class="header-anchor" href="#create-shared-buffer" aria-label="Permalink to &quot;**create_shared_buffer**&quot;">â€‹</a></h4><table tabindex="0"><thead><tr><th>è¿”å›å­—æ®µ</th><th style="text-align:center;">ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ptrs</td><td style="text-align:center;">List[int]</td><td>ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œå…ƒç´ ä¸ªæ•°ä¸ºworld_size</td></tr></tbody></table><p>åˆ›å»ºå…±äº«å†…å­˜å¹¶è¿”å›æŒ‡å‘å…±äº«å†…å­˜çš„æŒ‡é’ˆ$ptrs$,å…¶ä¸­è°ƒç”¨äº†CUDAå†…å­˜åˆ†é…å‡½æ•°ï¼Œå¹¶ä½¿ç”¨OpenIpcHandleæ‰“å¼€äº†å…¶ä»–åŒä¸€nodeä¸Šå…¶ä»–è®¾å¤‡çš„å…±äº«å†…å­˜handleã€‚</p><h3 id="capture" tabindex="-1"><strong>capture</strong>: <a class="header-anchor" href="#capture" aria-label="Permalink to &quot;**capture**:&quot;">â€‹</a></h3><p>è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ª <code>@contextmanager</code>ï¼Œä¸»è¦ç›®çš„æ˜¯åœ¨graph_captureæœ€åè°ƒç”¨ <code>register_graph_buffers</code>ï¼Œå°†æ‰€æœ‰allreduceç”¨åˆ°çš„è¾“å…¥åœ°å€æ³¨å†Œåˆ°rank_dataä¸­ã€‚</p><p>è§£é‡Šï¼šè¿™ä¸ªå‡½æ•°ä»…ç”¨äºCUDA graphæ¨¡å¼ä¸­ï¼Œåœ¨CUDA graph æ¨¡å¼ä¸­ï¼Œæ‰€æœ‰çš„æ“ä½œä¸ä¼šç«‹å³è¢«æ‰§è¡Œï¼ŒCUDAä¼šæ ¹æ®æ“ä½œé¢„å…ˆæ„å»ºè®¡ç®—å›¾ï¼Œå¹¶ä¸€æ¬¡æ€§æäº¤åˆ°GPUä¸­æ‰§è¡Œï¼Œå…¶ä¸­allreduceæ“ä½œè¿›è¡Œè¿›ç¨‹é—´é€šä¿¡éœ€è¦å°†inputæ³¨å†Œåˆ° <code>rank_data</code>ä¸­ï¼Œè¿™ä¸ªæ³¨å†Œçš„æ“ä½œä¸ä¼šæ¯æ¬¡è°ƒç”¨allreduceéƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œä¼šåœ¨è°ƒç”¨allreduceæ—¶å°†éœ€è¦æ³¨å†Œçš„ptrå­˜å…¥ä¸€ä¸ªå¾…æ³¨å†Œæ•°ç»„ï¼ˆ<code>graph_unreg_buffers_</code>ï¼‰ä¸­ï¼Œç­‰åˆ°è°ƒç”¨ <code>register_graph_buffers</code>æ—¶å†å°†è¿™äº›æœªè¢«æ³¨å†Œçš„ptr è¿›è¡Œ 1. allgatherè·å–å…¶ä»–è¿›ç¨‹ä¸­çš„handlesã€‚ 2. å°†è¿™äº›è·å–åˆ°çš„handlesæ‰“å¼€å¹¶æ³¨å†Œåˆ° <code>rank_data</code>ä¸­</p><h3 id="register-graph-buffers" tabindex="-1"><strong>register_graph_buffers</strong> <a class="header-anchor" href="#register-graph-buffers" aria-label="Permalink to &quot;**register_graph_buffers**&quot;">â€‹</a></h3><p>æ€»æ˜¯åœ¨captureä¸Šä¸‹æ–‡çš„æœ€åè°ƒç”¨ï¼Œå°†captureä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œçš„Allreduceä»£ç ä¸­éœ€è¦çš„inputå…¨éƒ¨é€šè¿‡open_ipc_handleè¿›è¡Œæ³¨å†Œ</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>@contextmanager</span></span>
<span class="line"><span>def capture(self):</span></span>
<span class="line"><span>	try:</span></span>
<span class="line"><span>		self._IS_CAPTURING = True</span></span>
<span class="line"><span>		yield</span></span>
<span class="line"><span>	finally:</span></span>
<span class="line"><span>		self._IS_CAPTURING = False</span></span>
<span class="line"><span>		if not self.disabled:</span></span>
<span class="line"><span>			self.register_graph_buffers()</span></span></code></pre></div><h3 id="all-reduce" tabindex="-1"><strong>all_reduce</strong> <a class="header-anchor" href="#all-reduce" aria-label="Permalink to &quot;**all_reduce**&quot;">â€‹</a></h3><p>å…ˆè¿›è¡Œä¸€ä¸ªæ¡ä»¶çš„åˆ¤æ–­ï¼ˆæ˜¯å¦å¤„äºCUDA graph æ¨¡å¼ï¼‰å¦‚æœä¸å¤„äºCUDA graph æ¨¡å¼ï¼Œç›´æ¥å°†inputæ‹·è´åˆ°é¢„å…ˆåˆ†é…çš„GPU bufferä¸­ï¼Œå¦‚æœå¤„äºCUDA graphæ¨¡å¼ï¼Œç›´æ¥inputæ”¾å…¥ <code>graph_unreg_buffers_</code>å¹¶è¿›è¡Œallreduceæ“ä½œã€‚å‰é¢è§£é‡Šäº†è¿™æ ·åšçš„åŸå› </p><p>åœ¨C++å‡½æ•°å†…éƒ¨æœ‰æ›´ç»†èŠ‚çš„å¤„ç†ï¼š</p><p>å¦‚æœæ»¡è¶³ä¸€äº›ç‰¹å®šæ¡ä»¶ï¼ˆfull_nvlink_ä¸”è¾“å…¥Tensoræ¯”è¾ƒå¤§ï¼Œåœ¨world_size&lt;=4æ—¶çš„é˜ˆå€¼ä¸º512KBï¼Œworld_size&lt;=8æ—¶çš„é˜ˆå€¼ä¸º256KBï¼‰ï¼Œå°†è°ƒç”¨ <code>cross_device_reduce_2stage</code>ï¼ˆCUDAæ ¸å‡½æ•°ï¼‰ï¼Œå¦åˆ™è°ƒç”¨ <code>cross_device_reduce_1stage</code></p><p><code>cross_device_reduce_2stage</code>è¯¦ç»†è§£é‡Šï¼š</p><ul><li><p><strong>stage 1: reduce scatter</strong> é¦–å…ˆï¼ŒèŠ‚ç‚¹ä¸­çš„æ‰€æœ‰GPUåªè´Ÿè´£ä¸€éƒ¨åˆ†çš„reduceï¼Œæ¯”å¦‚å¯¹äºä¸€ä¸ªGPUçš„rank=rankï¼Œå®ƒè´Ÿè´£å¤„ç† <code>input[start:end]</code> ï¼Œå…¶ä¸­</p><div class="language-apache vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">apache</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">part = size / ngpus; </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">start = rank * part ; </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">end = rank == world_size - </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ? size : start + part;</span></span></code></pre></div><p>å°†è¿™ä¸€éƒ¨åˆ†reduceä¹‹åçš„ç»“æœæ”¾å…¥ä¸€ä¸ªé¢„å…ˆåˆ†é…çš„shared_memoryä¸­</p></li><li><p><strong>stage 2: allgather.</strong> æ¯ä¸ªGPUè¯»å–shared_memory ä¸­çš„æ•°æ®ï¼Œå¹¶å°†è¿™äº›æ•°æ®copyåˆ°resultï¼ˆæœ€ç»ˆçš„è¿”å›ç»“æœ)ä¸­ã€‚</p></li></ul><p>é‡è¦ä»£ç ç®€åŒ–ç‰ˆï¼ˆéƒ¨åˆ†åŒæ­¥ä»£ç çœç•¥ï¼‰ï¼š</p><ul><li>ç¬¬ä¸€é˜¶æ®µ</li></ul><div class="language-apache vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">apache</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">for (int idx = start + tid; idx &lt; end; idx += stride) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    // å°†reduceç»“æœå­˜å…¥ä¿å­˜ä¸­é—´ç»“æœçš„å…±äº«å†…å­˜</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    tmp_shared_buf[rank][idx] = packed_reduce(ptrs,idx);//</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>ç¬¬2é˜¶æ®µï¼š</li></ul><div class="language-apache vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">apache</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">// allgatheræ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">for (int idx = tid; idx &lt; largest_part; idx += stride) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    for (int i = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i &lt; ngpus; i++) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        int gather_from_rank = ((rank + i) % ngpus);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        if (gather_from_rank == ngpus - </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> || idx &lt; part) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            int dst_idx = gather_from_rank * part + idx;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            result[dst_idx] = tmp_shared_buf[i][idx];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>å…³äºç¬¬äºŒé˜¶æ®µçš„åŒæ­¥æ“ä½œï¼Œéå¸¸é‡è¦ï¼š visibility across devices is only guaranteed between threads that have the same tid.</p><h2 id="reducescatter" tabindex="-1">ReduceScatter <a class="header-anchor" href="#reducescatter" aria-label="Permalink to &quot;ReduceScatter&quot;">â€‹</a></h2><p><img src="https://cdn.nlark.com/yuque/0/2024/png/32583568/1734110259288-a5efb5c4-9ab3-486c-9797-80a81cfa3363.png?x-oss-process=image%2Fformat%2Cwebp" alt=""> å››ä¸ªè®¾å¤‡çš„reduce scatteç¤ºæ„å›¾</p><p>ç¬¬ä¸€é˜¶æ®µï¼š reduce</p><ul><li>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸€ä¸ªå¾…reduceçš„Tensorï¼Œå‡è®¾æœ‰4ä¸ªè®¾å¤‡rank1 2 3 4ï¼Œåœ¨ç¬¬ä¸€é˜¶æ®µæ—¶ï¼Œæ¯ä¸ªGPUè´Ÿè´£ä¸€ä¸ªéƒ¨åˆ†çš„reduceï¼Œå¦‚GPU1è´Ÿè´£AåŒºåŸŸçš„reduceï¼ŒGPU2è´Ÿè´£BåŒºåŸŸä»¥æ­¤ç±»æ¨ã€‚</li><li>reduceç»“æŸåï¼Œæ¯ä¸ªGPUä¸Šçš„éƒ½å¾—åˆ°äº†æœ€ç»ˆreduceç»“æœçš„ä¸€éƒ¨åˆ†ï¼ˆä¿å­˜åœ¨ä¸´æ—¶ç¼“å†²åŒºï¼‰ï¼Œå°†å®ƒä»¬allgatherä¹‹åå°±å®Œæˆäº†å…¨éƒ¨çš„reduce</li></ul><p>ç¬¬äºŒé˜¶æ®µï¼š allgather</p><ul><li>è¿™é‡Œé¡ºåºæœ‰ä¸€å®šçš„è®²ç©¶ï¼Œæ¯”å¦‚rank2åœ¨allgaheræ“ä½œæ—¶ï¼Œè¯»å–çš„é¡ºåºä¾æ¬¡æ˜¯B C D Aï¼Œå› ä¸ºrank2ä¸­å·²ç»æœ‰Bçš„reduceç»“æœäº†ï¼Œrank3çš„é¡ºåºæ˜¯ C D A Bï¼Œ</li></ul><p>ä¸¤ä¸ªé˜¶æ®µä¸­çš„çº¿ç¨‹ï¼ˆGPUçº¿ç¨‹ï¼‰è¿›ç¨‹åŒæ­¥æ“ä½œï¼š</p><ol><li>æœ€ç®€å•çš„åŒæ­¥æ“ä½œï¼š æ‰€æœ‰GPUè®¾ç½®ä¸€ä¸ªbarrierç­‰æ‰€æœ‰GPUä¸Šçš„æ‰€æœ‰çº¿ç¨‹éƒ½reduceç»“æŸåå†è¿›è¡Œç¬¬äºŒé˜¶æ®µçš„allgatheræ“ä½œï¼Œ æ˜¾ç„¶è¿™æ ·çš„åŒæ­¥æ“ä½œæ‹–ç´¯äº†æ€§èƒ½</li><li>vllmçš„å®ç°ï¼š <code>Note: it&#39;s important to match the tid between the two stages, because visibility across devices is only guaranteed between threads that have the same tid. If thread i computes the sum of start + i in the first stage, then thread i also gathers start + i from all ranks.</code> ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡è®¾</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>world_size = 4</span></span>
<span class="line"><span>tensor.size() = 403</span></span></code></pre></div><ul><li>é‚£ä¹ˆï¼Œé™¤äº†æœ€åä¸€ä¸ªGPUï¼Œå…¶ä½™GPUè´Ÿè´£çš„åŒºåŸŸå¤§å°éƒ½æ˜¯ 403 / 4 = 100ï¼Œæœ€åä¸€ä¸ªGPUè´Ÿè´£çš„åŒºåŸŸå¤§å°æ˜¯103</li><li>å¯¹ä¸€ä¸ªè¿›ç¨‹å†…éƒ¨ï¼Œå‡è®¾æœ‰10ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆtidï¼ˆGPUçº¿ç¨‹idï¼‰ä¸º1çš„å°±è´Ÿè´£å¤„ç†ã€1ï¼Œ11ï¼Œ21ï¼Œ...ï¼Œ91ï¼Œ101ï¼ˆå¦‚æœæœ‰ï¼‰ã€‘</li></ul><p>åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œtid=1 çš„çº¿ç¨‹ï¼Œåœ¨allgatheré˜¶æ®µï¼Œéœ€è¦å…¶ä»–è¿›ç¨‹ä¸­tidç›¸åŒçš„çº¿ç¨‹reduceçš„ç»“æœï¼Œæ‰€ä»¥ä¸€ä¸ªçº¿ç¨‹ tid=1 çš„çº¿ç¨‹åªéœ€è¦ç­‰å¾…å…¶ä»– $tid=1,rank\in [0,ngpus]$ çº¿ç¨‹reduceç»“æŸåå°±å¯ä»¥è¿›è¡Œallgatheræ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒGPU1ä¸­çš„çº¿ç¨‹1è¦ç­‰å¾…æ‰€æœ‰GPUä¸­çš„tidä¸º1çš„çº¿ç¨‹1 reduceæ“ä½œç»“æŸä¹‹åæ‰èƒ½è¿›è¡Œç¬¬äºŒé˜¶æ®µçš„allgatheræ“ä½œã€‚</p><p>ä½†æ˜¯åœ¨ä»£ç ä¸­ï¼Œä¸€ä¸ªGPUä¸­çº¿ç¨‹çš„æ•°é‡æœ€é«˜è¾¾åˆ° $36 * 512$ ä¸ªï¼Œå¦‚æœä¸ºè¿™äº›çº¿ç¨‹å…¨éƒ¨è®¾ç½®åŒæ­¥æ“ä½œï¼ŒGPUä¹‹é—´çš„å¼€é”€æœªå…æœ‰äº›å¤§ï¼ˆ$36 * 512$ ä¸ªçº¿ç¨‹è¦ä¸å…¶ä»–GPUçš„çº¿ç¨‹è¿›è¡Œé€šä¿¡ï¼‰ã€‚ æºç ä¸­è®¾ç½®äº†å¤šä¸ªblockï¼Œæ¯ä¸ªblockä¸­æ´¾å‡ºå‰ngpusä¸ªçº¿ç¨‹ä¸å…¶ä»–è¿›ç¨‹è¿›è¡Œé€šä¿¡ï¼Œè¿™æ ·åªæœ‰36ä¸ªçº¿ç¨‹éœ€è¦è¿›è¡Œè·¨GPUçš„åŒæ­¥é€šä¿¡ï¼Œè¿›è¡ŒGPUä¹‹é—´çš„åŒæ­¥é€šä¿¡åï¼Œå†è¿›è¡ŒGPUå†…éƒ¨çš„åŒæ­¥ã€‚</p><p><strong>çœæµç‰ˆï¼š</strong><em>ç®€å•æ¥è¯´ï¼Œä¸€ä¸ªGPUä¸­æœ‰å¤šä¸ªçº¿ç¨‹ ï¼ˆ36 * 512ä¸ªï¼‰ï¼Œè¿™äº›çº¿ç¨‹è¢«åˆ†æˆå¤šä¸ªblock(36ä¸ª)ï¼Œæ¯ä¸ªblockæœ‰å¤šä¸ªthreadï¼ˆ512ä¸ªï¼‰ï¼Œ==å…¶ä¸­çº¿ç¨‹åŒæ­¥åªèƒ½å‘ç”Ÿåœ¨blockå†…</em>== æ‰€ä»¥ä¸Šé¢çš„æ­¥éª¤å¯ä»¥è¯´æˆæ˜¯æ¯ä¸ªblockæ´¾ $ngpus$ ä¸ªçº¿ç¨‹ä¸å…¶ä»–GPUè¿›è¡ŒåŒæ­¥æ“ä½œï¼ˆå¼€é”€è¾ƒå¤§ï¼‰ï¼Œç„¶åblockå†…çš„çº¿ç¨‹å†è¿›è¡ŒåŒæ­¥ã€‚</p><p><strong>Questionï¼š</strong> ï¼ˆ==è¿™é‡Œæˆ‘å¯¹æºä»£ç æ¯”è¾ƒæœ‰ç–‘é—®çš„ä¸€ä¸ªç‚¹æ˜¯ï¼šæ—¢ç„¶ç¬¬äºŒé˜¶æ®µallgatheråªæœ‰readæ“ä½œï¼Œä¸ºä»€ä¹ˆè¿˜è¦å°†ç¬¬ä¸€é˜¶æ®µçš„ç»“æœä¿å­˜åˆ°ä¸´æ—¶ç¼“å†²åŒºä¸­è€Œä¸æ˜¯ç›´æ¥ä¿å­˜åˆ°æœ€ç»ˆçš„ç»“æœä¸­ï¼Ÿ ç›´æ¥ä¿å­˜åˆ°resultä¸­æ„Ÿè§‰ä¸ä¼šå½±å“ç¬¬äºŒé˜¶æ®µçš„allgather==ï¼‰ å·²è§£å†³ï¼š è¿™é‡Œè¿›è¡Œè¿ç®—æ“ä½œæ—¶ï¼Œåªæœ‰inputå¼ é‡å’Œä¸´æ—¶ç¼“å†²åŒºæ˜¯è¢«æ³¨å†Œåˆ°shared_bufferä¸­çš„ï¼Œå…¶ä»–è¿›ç¨‹å¹¶ä¸èƒ½ç›´æ¥è®¿é—®åˆ°resultå¼ é‡ã€‚å¦‚æœæ¯æ¬¡è¿›è¡Œall reduceéƒ½æ³¨å†Œä¸€ä¸ªresultå˜é‡ä½œä¸ºå…±äº«å†…å­˜ï¼Œä¼šå¢åŠ è¿›ç¨‹é—´é€šä¿¡å¼€é”€ï¼ˆåœ¨è¿›ç¨‹é—´ä¼ é€’shared_memoryå¥æŸ„ï¼‰ã€‚</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-e257564d><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><a class="VPLink link pager-link prev" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/tailwind.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Previous page</span><span class="title" data-v-e257564d>tailwind</span><!--]--></a></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/yublog/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/jsxè¯¦è§£.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>Next page</span><span class="title" data-v-e257564d>jsxè¯¦è§£</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"blogs_hello.md\":\"DOcb59Xp\",\"blogs_å­¦ä¹ ç¬”è®°_index.md\":\"Dfg4Lne0\",\"blogs_å­¦ä¹ ç¬”è®°_tailwind.md\":\"FkW5eyPJ\",\"blogs_å­¦ä¹ ç¬”è®°_æ— ç« çš„çŸ¥è¯†_customallreduce.md\":\"C298wKmd\",\"blogs_å­¦ä¹ ç¬”è®°_æ— ç« çš„çŸ¥è¯†_jsxè¯¦è§£.md\":\"Bcx6wrDO\",\"blogs_å­¦ä¹ ç¬”è®°_æ— ç« çš„çŸ¥è¯†_react--usecontextç§’æ‡‚è¯¦è§£.md\":\"DdIGiJH-\",\"blogs_å­¦ä¹ ç¬”è®°_æ— ç« çš„çŸ¥è¯†_react--useeffectä½•æ—¶è°ƒç”¨.md\":\"DQb6ZJ2c\",\"blogs_å­¦ä¹ ç¬”è®°_æ— ç« çš„çŸ¥è¯†_react--useeffectæ¡ˆä¾‹è¯¦è§£.md\":\"HrfBYfs4\",\"blogs_å­¦ä¹ ç¬”è®°_æ— ç« çš„çŸ¥è¯†_react--usereducer.md\":\"lRJP-uzk\",\"blogs_å­¦ä¹ ç¬”è®°_æ— ç« çš„çŸ¥è¯†_react--userefè¯¦è§£.md\":\"DZHrdeFs\",\"blogs_å­¦ä¹ ç¬”è®°_æ— ç« çš„çŸ¥è¯†_reactç”Ÿå‘½å‘¨æœŸè¯¦è§£.md\":\"BOntXjTA\",\"blogs_å­¦ä¹ ç¬”è®°_æ— ç« çš„çŸ¥è¯†_ä¸ºä»€ä¹ˆitemçš„keyä¸èƒ½ç”¨index.md\":\"EagL4QQf\",\"blogs_å­¦ä¹ ç¬”è®°_æ— ç« çš„çŸ¥è¯†_å—æ§ç»„ä»¶input.md\":\"CBFW76QC\",\"blogs_å­¦ä¹ ç¬”è®°_æ— ç« çš„çŸ¥è¯†_å¦‚ä½•ç†è§£llmappæµå¼è¾“å‡º.md\":\"CFShd1eR\",\"blogs_å­¦ä¹ ç¬”è®°_æ— ç« çš„çŸ¥è¯†_æ¸²æŸ“æ˜¯ä»€ä¹ˆï¼Ÿ.md\":\"CRKRxrik\",\"blogs_å­¦ä¹ ç¬”è®°_æ— ç« çš„çŸ¥è¯†_é‡è§linkå’Œé‡è§scriptçš„åŒºåˆ«.md\":\"DQ4SZi6b\",\"blogs_å­¦ä¹ ç¬”è®°_ğŸ“–cssæ‹¨å¼€äº‘é›¾è§æ›™å…‰.md\":\"BSfHY0Nq\",\"blogs_å­¦ä¹ ç¬”è®°_ğŸ“–ä»0åˆ°1çš„reacté€Ÿæˆ.md\":\"DM9wKkZn\",\"blogs_æ‚è®°_index.md\":\"CAnuVYrc\",\"blogs_é¢ç»_index.md\":\"ChEYKX1U\",\"index.md\":\"B9OM73-L\",\"pages_about.md\":\"CfCPLLt4\",\"pages_projects.md\":\"WS3v31DE\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Yu's blog ğŸ¥º\",\"description\":\"A VitePress Site\",\"base\":\"/yublog/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"nav\":[{\"text\":\"ğŸŒ² About\",\"link\":\"/pages/about\"},{\"text\":\"â›„ï¸ Blogs\",\"link\":\"/blogs/hello.md\"}],\"outline\":\"deep\",\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/vuejs/vitepress\"}],\"sidebar\":{\"/blogs/\":[{\"items\":[{\"text\":\"hello\",\"link\":\"/blogs/hello.html\"},{\"text\":\"å­¦ä¹ ç¬”è®°\",\"items\":[{\"text\":\"index\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/index.html\"},{\"text\":\"tailwind\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/tailwind.html\"},{\"text\":\"æ— ç« çš„çŸ¥è¯†\",\"items\":[{\"text\":\"CustomAllreduce\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/CustomAllreduce.html\"},{\"text\":\"jsxè¯¦è§£\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/jsxè¯¦è§£.html\"},{\"text\":\"react--useContextç§’æ‡‚è¯¦è§£\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/react--useContextç§’æ‡‚è¯¦è§£.html\"},{\"text\":\"react--useEffectä½•æ—¶è°ƒç”¨\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/react--useEffectä½•æ—¶è°ƒç”¨.html\"},{\"text\":\"react--useEffectæ¡ˆä¾‹è¯¦è§£\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/react--useEffectæ¡ˆä¾‹è¯¦è§£.html\"},{\"text\":\"react--useReducer\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/react--useReducer.html\"},{\"text\":\"react--useRefè¯¦è§£\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/react--useRefè¯¦è§£.html\"},{\"text\":\"reactç”Ÿå‘½å‘¨æœŸè¯¦è§£\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/reactç”Ÿå‘½å‘¨æœŸè¯¦è§£.html\"},{\"text\":\"ä¸ºä»€ä¹ˆitemçš„keyä¸èƒ½ç”¨index\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/ä¸ºä»€ä¹ˆitemçš„keyä¸èƒ½ç”¨index.html\"},{\"text\":\"å—æ§ç»„ä»¶input\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/å—æ§ç»„ä»¶input.html\"},{\"text\":\"å¦‚ä½•ç†è§£llmappæµå¼è¾“å‡º\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/å¦‚ä½•ç†è§£llmappæµå¼è¾“å‡º.html\"},{\"text\":\"æ¸²æŸ“æ˜¯ä»€ä¹ˆï¼Ÿ\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/æ¸²æŸ“æ˜¯ä»€ä¹ˆï¼Ÿ.html\"},{\"text\":\"é‡è§linkå’Œé‡è§scriptçš„åŒºåˆ«\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/æ— ç« çš„çŸ¥è¯†/é‡è§linkå’Œé‡è§scriptçš„åŒºåˆ«.html\"}],\"collapsed\":true},{\"text\":\"ğŸ“–CSSæ‹¨å¼€äº‘é›¾è§æ›™å…‰\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/ğŸ“–CSSæ‹¨å¼€äº‘é›¾è§æ›™å…‰.html\"},{\"text\":\"ğŸ“–ä»0åˆ°1çš„reacté€Ÿæˆ\",\"link\":\"/blogs/å­¦ä¹ ç¬”è®°/ğŸ“–ä»0åˆ°1çš„reacté€Ÿæˆ.html\"}],\"collapsed\":true},{\"text\":\"æ‚è®°\",\"items\":[{\"text\":\"index\",\"link\":\"/blogs/æ‚è®°/index.html\"}],\"collapsed\":true},{\"text\":\"é¢ç»\",\"items\":[{\"text\":\"index\",\"link\":\"/blogs/é¢ç»/index.html\"}],\"collapsed\":true}]}],\"/pages/\":[{\"items\":[{\"text\":\"about\",\"link\":\"/pages/about.html\"},{\"text\":\"projects\",\"link\":\"/pages/projects.html\"}]}],\"/public/\":[{\"items\":[]}]}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>